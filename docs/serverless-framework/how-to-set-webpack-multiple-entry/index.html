<!doctype html>
<html lang="ko" dir="ltr" class="docs-wrapper plugin-docs plugin-id-default docs-version-current docs-doc-page docs-doc-id-serverless-framework/how-to-set-webpack-multiple-entry" data-has-hydrated="false">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v3.4.0">
<title data-rh="true">NestJs Webpack 적용 방법 | Dev.ian Lab</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:url" content="https://jay2u8809.github.io/docs/serverless-framework/how-to-set-webpack-multiple-entry"><meta data-rh="true" property="og:locale" content="ko"><meta data-rh="true" name="docusaurus_locale" content="ko"><meta data-rh="true" name="docsearch:language" content="ko"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="NestJs Webpack 적용 방법 | Dev.ian Lab"><meta data-rh="true" name="description" content="---"><meta data-rh="true" property="og:description" content="---"><link data-rh="true" rel="icon" href="/img/onigiri_favicon.jpg"><link data-rh="true" rel="canonical" href="https://jay2u8809.github.io/docs/serverless-framework/how-to-set-webpack-multiple-entry"><link data-rh="true" rel="alternate" href="https://jay2u8809.github.io/docs/serverless-framework/how-to-set-webpack-multiple-entry" hreflang="ko"><link data-rh="true" rel="alternate" href="https://jay2u8809.github.io/docs/serverless-framework/how-to-set-webpack-multiple-entry" hreflang="x-default"><link rel="alternate" type="application/rss+xml" href="/blog/rss.xml" title="Dev.ian Lab RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/blog/atom.xml" title="Dev.ian Lab Atom Feed"><link rel="stylesheet" href="/assets/css/styles.9b11e930.css">
<script src="/assets/js/runtime~main.20d6230c.js" defer="defer"></script>
<script src="/assets/js/main.7e71af63.js" defer="defer"></script>
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){try{return new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}}()||function(){try{return window.localStorage.getItem("theme")}catch(t){}}();t(null!==e?e:"light")}(),function(){try{const n=new URLSearchParams(window.location.search).entries();for(var[t,e]of n)if(t.startsWith("docusaurus-data-")){var a=t.replace("docusaurus-data-","data-");document.documentElement.setAttribute(a,e)}}catch(t){}}()</script><div id="__docusaurus"><div role="region" aria-label="본문으로 건너뛰기"><a class="skipToContent_fXgn" href="#__docusaurus_skipToContent_fallback">본문으로 건너뛰기</a></div><nav aria-label="메인" class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="사이드바 펼치거나 접기" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/"><div class="navbar__logo"><img src="/img/onigiri_icon.jpg" alt="Onigiri Logo" class="themedComponent_mlkZ themedComponent--light_NVdE"><img src="/img/onigiri_icon.jpg" alt="Onigiri Logo" class="themedComponent_mlkZ themedComponent--dark_xIcU"></div><b class="navbar__title text--truncate">Onigiri</b></a><a class="navbar__item navbar__link" tpye="docSidebar" sidebarid="defaultSidebar" href="/docs/intro">Dev.ian Lab</a><a class="navbar__item navbar__link" href="/blog">Blog</a></div><div class="navbar__items navbar__items--right"><a href="https://github.com/jay2u8809" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link" sort="1">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="어두운 모드와 밝은 모드 전환하기 (현재 밝은 모드)" aria-label="어두운 모드와 밝은 모드 전환하기 (현재 밝은 모드)" aria-live="polite"><svg viewBox="0 0 24 24" width="24" height="24" class="lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" class="darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg></button></div><div class="navbarSearchContainer_Bca1"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="__docusaurus_skipToContent_fallback" class="main-wrapper mainWrapper_z2l0"><div class="docsWrapper_hBAB"><button aria-label="맨 위로 스크롤하기" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docRoot_UBD9"><aside class="theme-doc-sidebar-container docSidebarContainer_YfHR"><div class="sidebarViewport_aRkj"><div class="sidebar_njMd"><nav aria-label="문서 사이드바" class="menu thin-scrollbar menu_SIkG"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/intro">Intro</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" href="/docs/category/aws">AWS</a><button aria-label="사이드바 분류 &#x27;AWS&#x27; 펼치기" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" href="/docs/category/nodejs">NodeJs</a><button aria-label="사이드바 분류 &#x27;NodeJs&#x27; 펼치기" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--active" href="/docs/category/serverless-framework">Serverless Framework</a><button aria-label="사이드바 분류 &#x27;Serverless Framework&#x27; 접기" aria-expanded="true" type="button" class="clean-btn menu__caret"></button></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/docs/serverless-framework/how-to-set-webpack-multiple-entry">NestJs Webpack 적용 방법</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" href="/docs/category/living-in-japan">Living in Japan</a><button aria-label="사이드바 분류 &#x27;Living in Japan&#x27; 펼치기" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li></ul></nav></div></div></aside><main class="docMainContainer_TBSr"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_VOVn"><div class="docItemContainer_Djhp"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Z_bl" aria-label="Breadcrumbs"><ul class="breadcrumbs" itemscope="" itemtype="https://schema.org/BreadcrumbList"><li class="breadcrumbs__item"><a aria-label="홈" class="breadcrumbs__link" href="/"><svg viewBox="0 0 24 24" class="breadcrumbHomeIcon_YNFT"><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill="currentColor"></path></svg></a></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item"><a class="breadcrumbs__link" itemprop="item" href="/docs/category/serverless-framework"><span itemprop="name">Serverless Framework</span></a><meta itemprop="position" content="1"></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link" itemprop="name">NestJs Webpack 적용 방법</span><meta itemprop="position" content="2"></li></ul></nav><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">이 페이지에서</button></div><div class="theme-doc-markdown markdown"><h1>AWS Lambda 다이어트 - Webpack 으로 소스코드의 사이즈를 줄이자</h1>
<div class="language-json codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-json codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">{</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  &quot;author&quot;: &quot;Onigiri.J&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  &quot;createdAt&quot;: &quot;2024-05-28&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  &quot;updatedAt&quot;: &quot;2024-05-28&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="클립보드에 코드 복사" title="복사" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<hr>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="intro">Intro<a class="hash-link" aria-label="Intro에 대한 직접 링크" title="Intro에 대한 직접 링크" href="/docs/serverless-framework/how-to-set-webpack-multiple-entry#intro">​</a></h2>
<blockquote>
<p>Webpack 을 이용해 AWS Lambda 에 업로드할 Nest.js 소스코드의 용량을 줄이는 방법을 정리한다.</p>
</blockquote>
<p>회사 프로젝트의 소스코드 용량이 점점 늘어나 <code>AWS Lambda Layer</code> 를 이용함에도 더 이상 Deploy 가 되지 않는 상황까지 왔다.</p>
<p>여러 번의 개선을 통해 다시 업로드가 되기도 했지만 커져가는 소스코드 용량을 감당하지 못하게 되어 결국 Webpack 을 도입하자고 제안하게 되었고 이번 Node 20 버전 업 작업을 통해 모든 AWS Lambda 에 webpack 을 적용했다.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="problem">Problem<a class="hash-link" aria-label="Problem에 대한 직접 링크" title="Problem에 대한 직접 링크" href="/docs/serverless-framework/how-to-set-webpack-multiple-entry#problem">​</a></h2>
<p>지금까지는 소스코드의 용량이 늘어날 때에 아래와 같은 방법으로 대응을 했다.</p>
<ul>
<li>AWS Lambda Layer 적용<!-- -->
<ul>
<li>serverless framework 의 <code>serverless-layers</code> plugin 적용</li>
</ul>
</li>
<li>타입스크립트 빌드 대상 조정<!-- -->
<ul>
<li><code>tsconfig.build.json</code> 의 exclude 항목에서 빌드가 필요없는 디렉토리 추가</li>
</ul>
</li>
<li>AWS Lambda Handler 의 indclude 대상 조정<!-- -->
<ul>
<li>AWS Lambda 의 include 항목에 최소한의 디렉토리를 지정하</li>
</ul>
</li>
</ul>
<p>어떻게든 최소한의 파일만 업로드하도록 수정하였으나 프로젝트가 커지고 소스코드가 늘어나면서 점점 한계에 이르렀다.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="error--aws-lambda-size-limit">Error : AWS Lambda Size Limit<a class="hash-link" aria-label="Error : AWS Lambda Size Limit에 대한 직접 링크" title="Error : AWS Lambda Size Limit에 대한 직접 링크" href="/docs/serverless-framework/how-to-set-webpack-multiple-entry#error--aws-lambda-size-limit">​</a></h3>
<p>AWS Lambda 를 serverless framework 로 Deploy 하면 이와 같은 에러로 Deploy 에 실패했다.</p>
<div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">... ○ Created layer package  ${PRJECT_NAME}.serverless/sample-project-dev-nodejs-default.zip (57.4 MB)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">... ○ Uploading layer package...</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">... ○ OK...</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ServerlessLayers error:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Action: Lambda:publishLayerVersion</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Params: {&quot;Content&quot;:{&quot;S3Bucket&quot;:&quot;sample-project-sls-deploy-bucket&quot;,&quot;S3Key&quot;:&quot;serverless/sample-project/dev/layers/sample-project-dev-nodejs-default.zip&quot;},&quot;LayerName&quot;:&quot;sample-project-dev-nodejs-default&quot;,&quot;Description&quot;:&quot;created by serverless-layers plugin&quot;,&quot;CompatibleRuntimes&quot;:[&quot;nodejs&quot;],&quot;CompatibleArchitectures&quot;:[&quot;x86_64&quot;,&quot;arm64&quot;]}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">AWS SDK error:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Unzipped size must be smaller than 262144000 bytes</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">⠇ Packaging (245s)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">error Command failed with exit code 1.</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="클립보드에 코드 복사" title="복사" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="solution">Solution<a class="hash-link" aria-label="Solution에 대한 직접 링크" title="Solution에 대한 직접 링크" href="/docs/serverless-framework/how-to-set-webpack-multiple-entry#solution">​</a></h2>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="nestjs-build-webpack-적용하여-빌드하기">Nest.js Build: Webpack 적용하여 빌드하기<a class="hash-link" aria-label="Nest.js Build: Webpack 적용하여 빌드하기에 대한 직접 링크" title="Nest.js Build: Webpack 적용하여 빌드하기에 대한 직접 링크" href="/docs/serverless-framework/how-to-set-webpack-multiple-entry#nestjs-build-webpack-적용하여-빌드하기">​</a></h3>
<p>결국에는 Webpack 을 이용해 소스코드의 사이즈를 줄여보기로 헀고, 다양한 Webpack 툴들이 있었지만 Nest.js 에서 공식적으로 지원하는 방식을 사용하기로 했다.</p>
<p><a href="https://docs.nestjs.com/cli/monorepo#webpack-options" target="_blank" rel="noopener noreferrer">Nest.js 의 공식 문서</a> 를 보면 <code>webpack.config.js</code> 파일이 필요하다. 이 파일부터 만들어보자.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="1-webpackconfigjs">1) webpack.config.js<a class="hash-link" aria-label="1) webpack.config.js에 대한 직접 링크" title="1) webpack.config.js에 대한 직접 링크" href="/docs/serverless-framework/how-to-set-webpack-multiple-entry#1-webpackconfigjs">​</a></h3>
<p>여러 개의 AWS Lambda 함수를 Deploy 할 때는 각 Handler 마다 Webpack Bundling (Webpack의 결과물) 파일이 필요하다.</p>
<p>예를 들어 아래의 3개 AWS Lambda 를 Deploy 한다고 가정하자.</p>
<ul>
<li>convertImage: 이미지를 변환하는 Lambda</li>
<li>backup: 이미지를 백업하는 Lambda</li>
<li>statisticUser: 유저정보의 통계를 내는 Lambda</li>
</ul>
<p>이 경우, 각 Lambda Handler 별로 Webpack bundling 을 한 파일들이 필요하다. 소스코드의 내용이 중복되더라도 각 handler 마다 webpack 이 적용된 파일들이 있어야한다는 뜻이다.</p>
<div class="language-javascript codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-javascript codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">module</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method-variable function-variable method function property-access" style="color:#d73a49">exports</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token parameter">options</span><span class="token parameter punctuation" style="color:#393A34">,</span><span class="token parameter"> webpack</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token arrow operator" style="color:#393A34">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword control-flow" style="color:#00009f">return</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token spread operator" style="color:#393A34">...</span><span class="token plain">options</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token literal-property property" style="color:#36acaa">entry</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token literal-property property" style="color:#36acaa">convertImage</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;./src/lambda/convert-image.ts&#x27;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token literal-property property" style="color:#36acaa">backupS3</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;./src/lambda/backup-s3.ts&#x27;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token literal-property property" style="color:#36acaa">statisticsUsers</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;./src/statistics/statistics-users.ts&#x27;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token literal-property property" style="color:#36acaa">externals</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token literal-property property" style="color:#36acaa">output</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token spread operator" style="color:#393A34">...</span><span class="token plain">options</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">output</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token literal-property property" style="color:#36acaa">clean</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">true</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token literal-property property" style="color:#36acaa">libraryTarget</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;commonjs2&#x27;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token literal-property property" style="color:#36acaa">filename</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;[name]-bundle.js&#x27;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token literal-property property" style="color:#36acaa">plugins</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token spread operator" style="color:#393A34">...</span><span class="token plain">options</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">plugins</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token keyword" style="color:#00009f">new</span><span class="token plain"> </span><span class="token class-name">webpack</span><span class="token class-name punctuation" style="color:#393A34">.</span><span class="token class-name">optimize</span><span class="token class-name punctuation" style="color:#393A34">.</span><span class="token class-name">LimitChunkCountPlugin</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token literal-property property" style="color:#36acaa">maxChunks</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="클립보드에 코드 복사" title="복사" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<ul>
<li>
<p>entry</p>
<ul>
<li>AWS Lambda 에 Deploy 할 handler 가 있는 파일을 지정한다.</li>
<li>파일의 경로는 프로젝트의 Root 를 기준으로 <code>절대경로</code>를 지정</li>
</ul>
</li>
<li>
<p>output.filename</p>
<ul>
<li>webpack 으로 bundling 했을 때, 생성할 파일명을 지정한다.</li>
<li><code>[name]</code> 에 entry 객체의 key 가 지정된다.<!-- -->
<ul>
<li><a href="https://qiita.com/sansaisoba/items/921438a19cbf5a31ec53" target="_blank" rel="noopener noreferrer">Qiita: webpackの基本だけどハマりやすいentryの設定と[name]</a></li>
</ul>
</li>
<li><em>[name].bundle.js</em> 처럼 <code>.</code> 을 이용하여 지정하지 않는다.<!-- -->
<ul>
<li>AWS Lambda 가 실행될 때 <code>Runtime.ImportModuleError</code> 가 발생한다.</li>
</ul>
</li>
</ul>
</li>
<li>
<p>plugins</p>
<ul>
<li><em>LimitChunkCountPlugin</em>
<ul>
<li>각 AWS Lambda 함수마다 1개의 파일로 만들어주는 plugin</li>
<li>연결된 소스코드가 많고 길 경우, Webpack 은 자동으로 chunk 하여 bundling 한다.</li>
<li>하나의 파일이 아닌 여러 개의 파일로 분할 될 수 있으므로 파일의 갯수를 지정할 경우 사용한다.</li>
</ul>
</li>
</ul>
</li>
</ul>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="2-nestjs-build">2) Nest.js Build<a class="hash-link" aria-label="2) Nest.js Build에 대한 직접 링크" title="2) Nest.js Build에 대한 직접 링크" href="/docs/serverless-framework/how-to-set-webpack-multiple-entry#2-nestjs-build">​</a></h3>
<p>webpack.config.js 파일을 작성했다면 올바르게 build 가 되는지 확인해보자. nest.js 의 webpack 옵션을 이용하여 build 한다. (Webpack bundling 파일은 dist 디렉토리에서 확인할 수 있다.)</p>
<ul>
<li>ex) <code>nest build --webpack --webpackPath ${webpack.config.js path}</code></li>
</ul>
<div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">$ nest build --webpack --webpackPath src/app/webpack.config.js</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="클립보드에 코드 복사" title="복사" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>꽤나 긴 명령어이므로 AWS Lambda 를 Serverless Framework 로 Deploy 할 때, webpack 을 적용해 build 하도록  package.json 을 수정한다.</p>
<div class="language-json codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-json codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">{</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  &quot;name&quot;: &quot;example-project&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  &quot;version&quot;: &quot;0.0.1&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  &quot;scripts&quot;: {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &quot;build&quot;: &quot;nest build&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &quot;deploy:lambda&quot;: &quot;nest build --webpack --webpackPath src/lambda/webpack.config.js &amp;&amp; sls deploy -c serverless.yaml&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="클립보드에 코드 복사" title="복사" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="3-deploy-serverless-framework">3) Deploy: Serverless Framework<a class="hash-link" aria-label="3) Deploy: Serverless Framework에 대한 직접 링크" title="3) Deploy: Serverless Framework에 대한 직접 링크" href="/docs/serverless-framework/how-to-set-webpack-multiple-entry#3-deploy-serverless-framework">​</a></h3>
<p>webpack 을 적용해 bundling 한 파일들이 Deploy 할 때 정확하게 업로드 될 수 있도록 Serverless Framework 의 <code>yaml</code> 파일의 수정도 필요하다.</p>
<div class="language-yaml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-yaml codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token punctuation" style="color:#393A34">...</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">functions</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">handleConvertImage</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">handler</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> dist/convertImage</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">bundle.handler</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">package</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">individually</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token boolean important" style="color:#36acaa">true</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">include</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> dist/convertImage</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">bundle.js</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> dist/</span><span class="token punctuation" style="color:#393A34">?</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">bundule.js</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> dist/</span><span class="token punctuation" style="color:#393A34">?</span><span class="token punctuation" style="color:#393A34">?</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">bundule.js</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">exclude</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;**&#x27;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">timeout</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">900</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">memorySize</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1024</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">events</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">sns</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> XXXXXXXXX</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">handleBackupS3</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">handler</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> dist/backupS3</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">bundle.backupUserHandler</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">package</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">individually</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token boolean important" style="color:#36acaa">true</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">include</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> dist/backupS3</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">bundle.js</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> dist/</span><span class="token punctuation" style="color:#393A34">?</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">bundule.js</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> dist/</span><span class="token punctuation" style="color:#393A34">?</span><span class="token punctuation" style="color:#393A34">?</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">bundule.js</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">exclude</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;**&#x27;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">timeout</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">900</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">memorySize</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1024</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">events</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">schedule</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> cron(10 18 L * </span><span class="token punctuation" style="color:#393A34">?</span><span class="token plain"> </span><span class="token important">*)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">handleStatisticsUsers</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">handler</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> dist/statisticsUsers</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">bundle.handler</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">package</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">individually</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token boolean important" style="color:#36acaa">true</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">include</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> dist/statisticsUsers</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">bundle.js</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> dist/</span><span class="token punctuation" style="color:#393A34">?</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">bundule.js</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> dist/</span><span class="token punctuation" style="color:#393A34">?</span><span class="token punctuation" style="color:#393A34">?</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">bundule.js</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">exclude</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;**&#x27;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">timeout</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">900</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">memorySize</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">4096</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">events</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">schedule</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> cron(30 22 * * </span><span class="token punctuation" style="color:#393A34">?</span><span class="token plain"> </span><span class="token important">*)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="클립보드에 코드 복사" title="복사" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<ul>
<li>
<p>handler</p>
<ul>
<li>webpack 으로 생성된 파일명에 해당하는 handler 함수명을 지정</li>
<li>webpack.config.js 의 entry 의 key 에 해당하는 파일</li>
</ul>
</li>
<li>
<p>include</p>
<ul>
<li>webpack 으로 생성된 파일명을 지정한다.<!-- -->
<ul>
<li><code>[name]-bundle.js</code></li>
</ul>
</li>
<li><strong>?-bundle.js</strong>
<ul>
<li>간혹 webpack 의 <code>LimitChunkCountPlugin</code> 를 이용해도 파일이 분할(chunk)되는 경우가 있다.</li>
<li><code>[name]-bundle.js</code> 의 경우, 분할된다면 [name] 에 숫자가 붙어 <code>8-bundle.js</code> 나 <code>10-bundle.js</code> 등의 숫자 파일이 생성된다.<!-- -->
<ul>
<li><a href="https://stackoverflow.com/questions/43507438/webpack-is-producing-lots-of-numbered-files" target="_blank" rel="noopener noreferrer">StackOverflow: webpack is producing lots of numbered files</a></li>
</ul>
</li>
<li>이러한 파일들도 함께 include 해야하기 때문에 글자 수에 맞춰 <code>?-bundle.js</code> 또는 <code>??-bundle.js</code> 를 지정한다.</li>
<li>소스코드가 길어질 경우에 분할 파일들이 생성될 수 있기에 반드시 해야하는 것은 아니다.</li>
</ul>
</li>
</ul>
</li>
</ul>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="conclusion">Conclusion<a class="hash-link" aria-label="Conclusion에 대한 직접 링크" title="Conclusion에 대한 직접 링크" href="/docs/serverless-framework/how-to-set-webpack-multiple-entry#conclusion">​</a></h2>
<ul>
<li>AWS Lambda 에 업로드할 파일의 사이즈가 1/10 이 되었다.</li>
<li>Serverless Framework 로 Deploy 할 때, 반드시 build 를 하게되었다.</li>
<li>build 시간이 꽤나 길어지게 되었다.</li>
</ul>
<p>AWS Lambda 의 사이즈 제한 문제로 인한 Deploy 실패를 해결해 보았다. Webpack 을 적용함으로써 AWS Lambda 에 업로드하는 소  스코드의 양이 엄청나게 줄어들게 되었다. (약 65MB -&gt; 약 5MB)</p>
<p>이를 통해 AWS Lambda 의 전체 소스코드 용량(75GB)에도 여유가 생기게 할 수 있었고, 동작확인 결과 Webpack 적용 전의 코드와 동일하게 동작함을 확인할 수 있었다.</p>
<p>또한, 가끔 코드를 수정한 뒤, build 를 하지 않고 deploy 했던 경우가 있었는데, 수정 내용이 전혀 반영되지 않아 당황했던 적이 있다. webpack 처리를 위해 반드시 build 를 해야하기에 그런 실수를 할 일이 없어졌다.</p>
<p>다만 아쉬운 점은 이를 통해 build 시간이 꽤나 길어졌다는 것이다. webpack 을 적용하는 시간이 걸리면서 약 30초 이상, 경우에 따라서는 약 3분 이상 build 시간이 늘어났다. build 시간은 단축 할 수 있는 다른 툴들도 알아봐야할 필요가 생겼다.</p>
<br>
<br>
<br>
<br>
<br>
<hr>
<ul>
<li>Refs:<!-- -->
<ul>
<li><a href="https://webpack.js.org/concepts/entry-points/" target="_blank" rel="noopener noreferrer">Webpack.js.org: Entry Point</a></li>
<li><a href="https://webpack.js.org/plugins/limit-chunk-count-plugin" target="_blank" rel="noopener noreferrer">Webpack.js.org: LimitChunkCountPlugin</a></li>
<li><a href="https://webpack.js.org/configuration/output/" target="_blank" rel="noopener noreferrer">Webpack.js.org: Output</a></li>
</ul>
</li>
</ul></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="row margin-top--sm theme-doc-footer-tags-row"><div class="col"><b>태그:</b><ul class="tags_jXut padding--none margin-left--sm"><li class="tag_QGVx"><a class="tag_zVej tagRegular_sFm0" href="/docs/tags/devian-lab">devian-lab</a></li><li class="tag_QGVx"><a class="tag_zVej tagRegular_sFm0" href="/docs/tags/project">project</a></li><li class="tag_QGVx"><a class="tag_zVej tagRegular_sFm0" href="/docs/tags/serverless-framework">serverless framework</a></li><li class="tag_QGVx"><a class="tag_zVej tagRegular_sFm0" href="/docs/tags/aws-lambda">aws lambda</a></li><li class="tag_QGVx"><a class="tag_zVej tagRegular_sFm0" href="/docs/tags/webpack">webpack</a></li><li class="tag_QGVx"><a class="tag_zVej tagRegular_sFm0" href="/docs/tags/multiple-entry">multiple entry</a></li><li class="tag_QGVx"><a class="tag_zVej tagRegular_sFm0" href="/docs/tags/nest-js">nest.js</a></li></ul></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="문서 페이지"><a class="pagination-nav__link pagination-nav__link--prev" href="/docs/category/serverless-framework"><div class="pagination-nav__sublabel">이전</div><div class="pagination-nav__label">Serverless Framework</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/docs/category/living-in-japan"><div class="pagination-nav__sublabel">다음</div><div class="pagination-nav__label">Living in Japan</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a class="table-of-contents__link toc-highlight" href="/docs/serverless-framework/how-to-set-webpack-multiple-entry#intro">Intro</a></li><li><a class="table-of-contents__link toc-highlight" href="/docs/serverless-framework/how-to-set-webpack-multiple-entry#problem">Problem</a><ul><li><a class="table-of-contents__link toc-highlight" href="/docs/serverless-framework/how-to-set-webpack-multiple-entry#error--aws-lambda-size-limit">Error : AWS Lambda Size Limit</a></li></ul></li><li><a class="table-of-contents__link toc-highlight" href="/docs/serverless-framework/how-to-set-webpack-multiple-entry#solution">Solution</a><ul><li><a class="table-of-contents__link toc-highlight" href="/docs/serverless-framework/how-to-set-webpack-multiple-entry#nestjs-build-webpack-적용하여-빌드하기">Nest.js Build: Webpack 적용하여 빌드하기</a></li><li><a class="table-of-contents__link toc-highlight" href="/docs/serverless-framework/how-to-set-webpack-multiple-entry#1-webpackconfigjs">1) webpack.config.js</a></li><li><a class="table-of-contents__link toc-highlight" href="/docs/serverless-framework/how-to-set-webpack-multiple-entry#2-nestjs-build">2) Nest.js Build</a></li><li><a class="table-of-contents__link toc-highlight" href="/docs/serverless-framework/how-to-set-webpack-multiple-entry#3-deploy-serverless-framework">3) Deploy: Serverless Framework</a></li></ul></li><li><a class="table-of-contents__link toc-highlight" href="/docs/serverless-framework/how-to-set-webpack-multiple-entry#conclusion">Conclusion</a></li></ul></div></div></div></div></main></div></div></div><footer class="footer footer--dark"><div class="container container-fluid"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">Docs</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="/docs/intro">Dev.ian Lab</a></li><li class="footer__item"><a class="footer__link-item" href="/blog">Blog</a></li></ul></div><div class="col footer__col"><div class="footer__title">Community</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://velog.io/@jay2u8809/posts" target="_blank" rel="noopener noreferrer" class="footer__link-item">Velog<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div><div class="col footer__col"><div class="footer__title">More</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://github.com/jay2u8809" target="_blank" rel="noopener noreferrer" class="footer__link-item">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">Copyright © 2024 J.ian. Built with Docusaurus.</div></div></div></footer></div>
</body>
</html>